<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tax CPA Chatbot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f8fafc;height:100vh;display:flex;flex-direction:column}
    header{background:linear-gradient(135deg,#1e293b,#334155);color:white;padding:1rem;text-align:center;font-weight:600;font-size:1.1rem;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
    #chat-container{flex:1;padding:1.5rem 1rem;overflow-y:auto;background:#f1f5f9;max-width:800px;margin:0 auto;width:100%}
    .message{margin-bottom:1rem;padding:1rem;border-radius:1rem;max-width:75%;word-wrap:break-word}
    .user{background:#3b82f6;color:white;margin-left:auto;text-align:right}
    .bot{background:white;color:#1e293b;margin-right:auto;box-shadow:0 1px 3px rgba(0,0,0,0.1)}
    #input-container{background:#fff;padding:1rem;border-top:1px solid #e2e8f0;display:flex;gap:0.5rem;max-width:800px;margin:0 auto;width:100%;box-shadow:0 -2px 10px rgba(0,0,0,0.05)}
    #message-input{flex:1;padding:0.75rem;border:1px solid #cbd5e1;border-radius:0.5rem;font-size:1rem;outline:none}
    #message-input:focus{border-color:#3b82f6;box-shadow:0 0 0 3px rgba(59,130,246,0.1)}
    #send-btn{padding:0.75rem 1.5rem;background:#3b82f6;color:white;border:none;border-radius:0.5rem;font-weight:500;cursor:pointer;font-size:1rem}
    #send-btn:hover{background:#2563eb}
    #send-btn:disabled{opacity:0.6;cursor:not-allowed;background:#94a3b8}
    .typing{display:flex;align-items:center;gap:0.25rem}
    .typing span{background:#cbd5e1;border-radius:50%;height:8px;width:8px;animation:pulse 1.5s infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
    @media(max-width:640px){#chat-container{padding:1rem}#input-container{padding:1rem 1rem}}
  </style>
</head>
<body>
  <header>ðŸ’¼ Tax CPA Assistant for Self-Employed</header>
  <div id="chat-container">
    <div class="message bot">
      Hi! I'm your tax CPA assistant. Ask me about:<br>
      â€¢ Business deductions<br>
      â€¢ Quarterly estimated taxes<br>
      â€¢ Schedule C filing<br>
      â€¢ Home office expenses<br>
      â€¢ 1099 forms & more
    </div>
  </div>
  <div id="input-container">
    <input id="message-input" type="text" placeholder="Type your tax question..." autocomplete="off">
    <button id="send-btn">Send</button>
  </div>

  <script>
    const chatContainer = document.getElementById('chat-container');
    const input = document.getElementById('message-input');
    const sendBtn = document.getElementById('send-btn');
    const API_URL = 'chat';

    function addMessage(text, isUser) {
      const div = document.createElement('div');
      div.className = `message ${isUser ? 'user' : 'bot'}`;
      div.textContent = text;
      chatContainer.appendChild(div);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function showTyping() {
      const typingDiv = document.createElement('div');
      typingDiv.id = 'typing';
      typingDiv.className = 'message bot typing';
      typingDiv.innerHTML = '<span></span><span></span><span></span>';
      chatContainer.appendChild(typingDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      return typingDiv;
    }

    async function sendMessage() {
      const text = input.value.trim();
      if (!text) return;

      addMessage(text, true);
      input.value = '';
      input.focus();

      const typingIndicator = showTyping();
      sendBtn.disabled = true;

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: text })
        });

        const data = await response.json();
        typingIndicator.remove();

        if (data.error) {
          addMessage('Error: ' + data.error, false);
        } else {
          addMessage(data.reply, false);
        }
      } catch (error) {
        typingIndicator.remove();
        addMessage('Network error. Please try again.', false);
      } finally {
        sendBtn.disabled = false;
        input.focus();
      }
    }

    sendBtn.addEventListener('click', sendMessage);
    input.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    input.focus();
  </script>
</body>
</html>
